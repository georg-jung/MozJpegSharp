stages:
- stage: Pack
  displayName: Build and Pack
  dependsOn: BuildNativeLibs
  jobs:
  - job: pack
    # condition: and(succeeded(), or(startsWith(variables['build.sourceBranch'], 'refs/heads/release/'), eq(variables['build.sourceBranch'], 'refs/heads/master')))
    pool:
      vmImage: 'windows-latest'
    steps:
    - template: ../steps/build.yml
    - script: |
        mkdir $(System.DefaultWorkingDirectory)\empty
      displayName: Mk empty directory used in NativeAssets nupkg creation
    - task: DotNetCoreCLI@2
      inputs:
        command: pack
        packagesToPack: '$(SrcDir)/**/*.csproj;!**/*.Tests.csproj'
        configuration: $(BuildConfiguration)
        packDirectory: $(Build.ArtifactStagingDirectory)/MozJpegSharp
        arguments: '--no-restore --no-build'
      displayName: 'Pack'
    - task: PublishBuildArtifacts@1
      inputs:
        pathtoPublish: '$(Build.ArtifactStagingDirectory)/MozJpegSharp'
        artifactName: 'nuget'
        publishLocation: 'Container'
      displayName: Publish
