parameters:
- name: 'dependsOn'
  type: object
  default: []

stages:
- stage: Pack
  displayName: Pack
  dependsOn:
  - ${{ if parameters.dependsOn }}:
    - ${{ parameters.dependsOn }}
  jobs:
  - job: pack
    # condition: and(succeeded(), or(startsWith(variables['build.sourceBranch'], 'refs/heads/release/'), eq(variables['build.sourceBranch'], 'refs/heads/master')))
    pool:
      vmImage: 'windows-latest'
    steps:
    - template: ../steps/downloadnativeartifacts.yml
    - script: |
        mkdir $(System.DefaultWorkingDirectory)\empty
      displayName: Mk empty directory used in NativeAssets nupkg creation
    - task: DotNetCoreCLI@2
      inputs:
        command: pack
        packagesToPack: '$(SrcDir)/**/*NativeAssets.csproj;!**/*.Tests.csproj'
        configuration: $(BuildConfiguration)
        packDirectory: $(Build.ArtifactStagingDirectory)/MozJpegSharp
        arguments: '--no-restore --no-build'
      displayName: 'Pack'
    - publish: '$(Build.ArtifactStagingDirectory)/MozJpegSharp'
      artifact: 'nuget'
      displayName: Publish
